name: Web3 Backend CI

# ğŸ” NÃ¤r ska pipelinen kÃ¶ras?
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Checka ut koden frÃ¥n GitHub-repot
      - name: ğŸ”„ Checkout koden
        uses: actions/checkout@v3

      # 2ï¸âƒ£ Installera rÃ¤tt Node-version
      - name: ğŸŸ¢ Installera Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'npm' # Cacha npm-moduler fÃ¶r snabbare kÃ¶rningar

      # 3ï¸âƒ£ Installera projektets dependencies (rot, dÃ¤r hardhat finns)
      - name: ğŸ“¦ Installera root dependencies
        run: npm ci
        # AnvÃ¤nder npm ci fÃ¶r att installera exakt de versioner som anges i package-lock.json
      #    Detta Ã¤r snabbare och mer pÃ¥litligt fÃ¶r CI/CD Ã¤n npm install
      #    Om du anvÃ¤nder yarn, byt ut npm ci mot yarn install
      # 4ï¸âƒ£ Installera backend-API:t's egna dependencies
      - name: ğŸ“¦ Installera backend dependencies
        run: |
          cd backend
          npm ci
        # GÃ¥ in i backend-mappen och installera dess dependencies

      - name: Cache Hardhat compiler
        uses: actions/cache@v3
        with:
          path: |
            ~/.cache/hardhat-nodejs
          key: ${{ runner.os }}-hardhat-${{ hashFiles('**/hardhat.config.js') }}

      # 5ï¸âƒ£ Kompilera smarta kontrakt (mÃ¥ste kÃ¶ras i rotmappen)
      - name: ğŸ”¨ Kompilera smarta kontrakt
        run: |
          npx hardhat compile

      # 6ï¸âƒ£ KÃ¶r tester (t.ex. test/MyContract.test.js)
      - name: ğŸ§ª Testa smarta kontrakt
        run: |
          npx hardhat test
